<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Pierre Delisle">
   <title>JSTL: Expression Language Support Tags -- Functional Description</title>
</head>
<body bgcolor="#FFFFFF">
<h2>

  <hr WIDTH="100%" noshade>
</h2>

<h2>
Expression Language Support Tags - Functional Description</h2>
<h2><tt>&lt;expr><br>
  &lt;set><br>
  &lt;declare&gt; </tt></h2>
<hr width="100%" noshade>
<h3>
1. <tt>&lt;expr></tt></h3>
The <tt>&lt;expr></tt> action evaluates an expression and outputs the result
of the evaluation to the current JspWriter object. It is the equivalent
of <tt>&lt;%= %></tt> with the difference that it is meant for the Expression
Language world (as opposed to the scripting language world).
<p>The expression to be evaluated is specified via the attribute <tt>value</tt>
and must be in the syntax of the current Expression Language. The result
of the evaluation is coerced to a String and is subsequently emitted into
the current JspWriter object.
<p>For example:
<p><tt>&nbsp; Hello &lt;c:expr value="$request:name"/></tt>
<p>is equivalent to
<p><tt>&nbsp; Hello &lt;%=pageContext.getAttribute("name", PageContext.SCOPE_REQUEST)%></tt>
<p>assuming the expression language interprets the elexprvalue <tt>$request:name</tt>
as meaning the value of the name attribute in the request scope.
<p>As a convenience, this action also supports the notion of <i>default value</i> 
  for cases where the value of an object in the elexprvalue is not accessible. 
  The default condition is triggered when the Expression Language throws an ExpressionException 
  while evaluating the expression (to report failure to complete evaluation satisfactorily) 
  or if the evaluation of the expression completes, but the result is null. This 
  condition usually happens when one of the objects in the expression is null. 
  For example, in the example below, this exception would be thrown if the address 
  property of the customer object were null. Check the details of the expression 
  language to clearly understand under which circumstances the ExpressionException 
  is thrown. 
<p>The default value can be specified either via attribute <tt>default:</tt>
<p><tt>&nbsp;&nbsp;&nbsp; &lt;c:expr value="$customer.address.city" default="unknown"/></tt>
<p>or within the body of the tag:
<p><tt>&nbsp;&nbsp;&nbsp; &lt;c:expr value="$customer.address.city"></tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;acme:defaultCity/></tt>
<br><tt>&nbsp;&nbsp;&nbsp; &lt;/c:expr></tt>
<p>The two ways to specify a default value cannot be used simultaneously.
<p>The <tt>&lt;expr></tt> action&nbsp; is only available in the EL version of 
  the library. 
<h3>
2. <tt>&lt;set></tt></h3>
The <tt>&lt;set></tt> action sets the value of an attribute in any of the
JSP scopes (page, request, session, application). If the attribute does
not already exist, it is created.
<p>The JSP scoped attribute can be set either from attribute value:
<p><tt>&nbsp; &lt;c:set var="foo" scope="session" value="..."/></tt> 
<p>or from the body of the tag:
<p><tt>&nbsp; &lt;c:set var="foo"></tt> <br>
  <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...</tt>
<br><tt>&nbsp; &lt;/c:set></tt>
<p>Setting the value of a JSP scoped attribute from the tag's body content&nbsp;
is useful to solve the problem associated with the fact that a tag attribute's
value cannot be set from a tag. In the past, a tag developer would have
to offer extra "attributes as tags" so the value of these attributes could
be set from other tags. For example:
<p><tt>&nbsp; &lt;acme:atag></tt> <br>
  <tt>&nbsp;&nbsp;&nbsp; &lt;x:att1>&lt;x:foo>mumbojumbo&lt;/x:foo>&lt;/x:att1></tt>
<br>
  <tt>&nbsp; &lt;/acme:atag></tt> 
<p>With the <tt>&lt;set></tt> tag, this can be handled without requiring
the extra <tt>&lt;att1></tt> tag.
<p><tt>&nbsp; &lt;c:set var="att1">&lt;x:foo>mumbojumbo&lt;/x:foo>&lt;/c:set></tt> 
  <br>
  <tt>&nbsp; &lt;acme:atag att1="$att1"/></tt> 
<p><font size=+0>Attribute <tt>scope</tt> is used to specify the scope
of the JSP attribute targetted by the &lt;set> tag. It is an optional attribute
that defaults to "page". The accepted values are restricted to: page, request,
session, and application.</font>
<p><font size=+0>The &lt;set> tag is only available in the EL version of the library</font><font size=+0>.</font> 
<h3> 3. <tt>&lt;declare></tt></h3>
Given that an Expression Language is supported in JSTL, the need for scripting
should be reduced substantially. However, until a JSP.next comes around
with native support for the Expression Language, page authors will still
have to deal with situations where some attributes of non-JSTL tags must
be specified as rtexprvalues.
<p>For example, &lt;myTag> below expects to receive an "Order" object using an 
  rtexprvalue. Because <code>var</code> is not exported as a scripting variable 
  in the &lt;forEach> tag, the code below would trigger a translation time error 
  because the scripting variable customer does not exist. 
<p><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;c:forEach items="$customers" var="customer"></tt> 
  <br>
  <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;acme:myTag order=&lt;%=customer.getOrder()%>
/></tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/c:forEach></tt>
<p>There needs to be a simple way to define a scripting variable to bridge
the gap between the EL and scripting worlds until JSP.next comes.
<p>The <tt>&lt;declare></tt> tag is used for that purpose. In the example below, 
  a scripting variable "customer" is created as a reference to the JSP scoped 
  attribute of the same name. 
<p><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;c:forEach items="$customers" var="customer"></tt> 
  <br>
  <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;c:declare id="customer" 
  type="acme.Customer"/></tt> <br>
  <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;acme:myTag order=&lt;%=customer.getOrder()%>
/></tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/c:forEach></tt>
<p>When jsp.next comes, the above code would simply become:
<p><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;c:forEach items="$customers" var="customer"></tt> 
  <br>
  <tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;acme:myTag order="$customer.order"
/></tt>
<br><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/c:forEach></tt>
<p>without requiring any modification to the <tt>&lt;acme:myTag></tt> tag.
<p>The same requirement for a bridge between the EL and scripting worlds exists 
  whether a page author uses the EL or RT version of JSTL. This tag therefore 
  exists in both the EL and RT versions of thelibrary. 
<ul>
  <li> <b><tt>id</tt></b> The name of the scripting variable to be exported</li>
  <li> <b><tt>type</tt></b> The type of the scripting variable. Optional. Defaults 
    to java.lang.Object.</li>
</ul>
The visibility of the scripting variable is always AT_END. <br>
&nbsp;
</body>
</html>
